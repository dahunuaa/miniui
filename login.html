<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
	<meta http-equiv="content-security-policy">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!--<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />-->
    <title>hello baosteel</title>
    <link href="css/mui.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <style>
    	
			.mui-input-group {
				margin-top: 10px;
			}
			.mui-input-group:first-child {
				margin-top: 20px;
			}
			.mui-input-group label {
				width: 22%;
			}
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				width: 78%;
			}
			.mui-checkbox input[type=checkbox],
			.mui-radio input[type=radio] {
				top: 6px;
			}
			.mui-content-padded {
				margin-top: 25px;
			}
			.mui-btn {
				padding: 10px;
			}
			
			
    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
	<h1 class="mui-title">欢迎登陆宝钢集团出差信息管理系统</h1>
	</header>
	<div class="mui-content">
	   <img alt="bs_1" src="img/bg_2.png" style="width:-webkit-fill-available";/>
		<form id="login-form" class="mui-input-group">
			<div class="mui-input-row">
				<label>工号</label>
				<input id="account" type="text" class="mui-input-clear mui-input" placeholder="请输入账号" />
			</div>
			<div class="mui-input-row">
				<label>密码</label>
				<input id="password" type="password" class="mui-input-clear mui-input" placeholder="请输入密码" />
			</div>
		</form>
			<div class="mui-input-row mui-checkbox mui-left" id="rember_account">
				<label id="remb_lable">记住工号和密码：No</label>
				<input name="checkbox" id="rember_acc_psw" value="Item 1" type="checkbox">
			</div>
		</form>
		
		<div class="mui-content-padded">
			<button id="login" class="mui-btn mui-btn-block mui-btn-primary">登录</button>
			</div>
		</div>
		
    <div align="center" ><font size="1"> ALL RIGHT RESERVED @BAOSTEEL</font></div>
	</div>
	
	<!--js/update.js好用，只有在打包安装的时候好用，真机调试的时候不行-->
	<script type="text/javascript" src="js/update.js" ></script>
	<script src="js/mui.min.js"></script>
	<script src="js/mui.enterfocus.js"></script>
	<script src="js/app.js"></script>
	<script type="text/javascript" src="js/basepath.js" ></script>
	<script>
		(function ($, doc) {
			$.init();
			mui('#rember_account').on('change', 'input', function() {
			var value = this.checked?"Yes":"No";
			this.previousElementSibling.innerText = "记住工号和密码："+value;
			localStorage.setItem("value",value)
			});
			
			
			$.plusReady(function() {
//					mui.preload({
//						"id": 'main',
//						"url": 'main.html',
//					});
					
					//检查 "登录状态/锁屏状态" 结束
					var loginButton = doc.getElementById('login');
					var accountBox = doc.getElementById('account');
					var passwordBox = doc.getElementById('password');
					
					if(localStorage.getItem("value") == "Yes"){
						document.getElementById("rember_acc_psw").checked="true"
						document.getElementById("remb_lable").innerHTML="记住工号和密码：Yes"
						accountBox.value = localStorage.getItem("user_account")
						passwordBox.value = localStorage.getItem("user_psw")	
					}else{
						accountBox.value = ""
						passwordBox.value = ""	
					}
					
					loginButton.addEventListener('tap', function(event) {
						if (accountBox.value==""||passwordBox.value=="") {
							plus.nativeUI.toast("用户名或密码错误")
						} else{
						localStorage.setItem("user_account",accountBox.value);//accountBox.value只有在表单提交的时候会显示其值
						localStorage.setItem("user_psw",passwordBox.value);
						mui.ajax()
						
						
						$.ajax({
						type: "post",
						url: basepath+"api/v1.0/user/login",
						data: {
							"mobile": accountBox.value,
							"password": passwordBox.value
						},
						async: true,
						dataType:"json",//后台传json的话这儿需要写成json
						success: function(data) {
							if (data.response.success=="1"){
//								console.info(JSON.stringify(data))
								localStorage.setItem("token",data.response.data.token);
								localStorage.setItem("user_id",data.response.data._id);
								localStorage.setItem("mobile",data.response.data.mobile);
								localStorage.setItem("name",data.response.data.name);
								localStorage.setItem("job_no",data.response.data.job_no);
								localStorage.setItem("scope",data.response.data.scope);
								mui.openWindow({
									url:'main.html',
									id:'main',
								})
							}else{
								plus.nativeUI.toast("用户名或密码错误")
							}
						},
						error: function() {
							plus.nativeUI.toast("请求服务器出现失败!");
						}
					});
					}
					});
					
					$.enterfocus('#login-form input', function() {
						$.trigger(loginButton, 'tap');
					});

//			按返回键直接返回到手机页面
			$.back = function(event) {
				plus.runtime.quit();
			}
				
			});		
		}(mui, document));
	</script>
	
</body> 
</html>